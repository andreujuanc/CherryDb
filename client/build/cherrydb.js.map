{"version":3,"file":"cherrydb.js","sources":["../src/sync/index.ts","../src/data/Store.ts","../src/data/Record.ts","../src/endpoint/Remote.ts","../src/main.ts"],"sourcesContent":["import Store from \"../data/Store\";\r\nimport Remote from \"../endpoint/Remote\";\r\n\r\nexport default class Sync {\r\n    private _data: Store;\r\n    private _remote: Remote;\r\n    constructor(data: Store, remote: Remote) {\r\n        this._data = data;\r\n        this._remote = remote;\r\n    }\r\n\r\n    async Start() {\r\n        try {\r\n            let lastId: string = null;\r\n            const lastRecord = this._data.GetLastRecord();\r\n            if (lastRecord != null)\r\n                lastId = lastRecord.id;\r\n            const remoteData = this._remote.getNewRecordsFrom(lastId);\r\n            return 1;\r\n        }\r\n        catch (ex) {\r\n            throw ex;\r\n        }\r\n    }\r\n}","import IRecord from \"./IRecord\";\r\n\r\nexport default class Store {\r\n    private _data: IRecord[];\r\n    constructor() {\r\n        this._data = [];\r\n    }\r\n\r\n    GetLastRecord(): IRecord {\r\n        if (this._data.length === 0) return null;\r\n        return this._data[0];\r\n    }\r\n    GetLastRecordTimeStamp(): number {\r\n        const lastRecord = this.GetLastRecord();\r\n        if (lastRecord == null)\r\n            return 0;\r\n        return lastRecord.timestamp;\r\n    }\r\n    Upsert(record: IRecord) {\r\n        const index = this._data[record.id];\r\n        if (index) {\r\n            this._data[index] = record;\r\n        }\r\n        else {\r\n            this._data.push(record);\r\n        }\r\n    }\r\n}","import IRecord from './IRecord';\r\n\r\nexport default  class Record implements IRecord {\r\n    id: string;    \r\n    timestamp: number;\r\n}","import IRecord from \"../data/IRecord\";\r\nimport Record from \"../data/Record\";\r\n//import { Promise } from \"es6-promise\";\r\n\r\n\r\nexport default class Remote {\r\n\r\n    private _endpoint: string;\r\n\r\n    constructor(endpoint: string) {\r\n        this._endpoint = endpoint;\r\n    }\r\n\r\n    getNewRecordsFrom(recordId: string): Promise<Record[]> {\r\n        return fetch(`${this._endpoint}`)\r\n            .then((response) => {\r\n                if (response.ok)\r\n                    return response.json();\r\n                return null;\r\n            })\r\n            .then(items=>items.map( (x)=> new Record() ))\r\n            .finanlly(x=>{\r\n\r\n            })\r\n    }\r\n\r\n    async Send(record: IRecord) : Promise<IRecord> {\r\n        return new Promise<IRecord>((r)=>r(record));\r\n    }\r\n}","import Sync from \"./sync\";\r\nimport Store from \"./data/Store\";\r\nimport Remote from \"./endpoint/Remote\";\r\n\r\nexport default class CheeryDb\r\n{\r\n    private _sync: Sync;\r\n    private _data: Store;\r\n    private _remote: Remote;\r\n    constructor(endpoint: string)\r\n    {\r\n        this._data = new Store();\r\n        this._remote = new Remote(endpoint);\r\n        this._sync = new Sync(this._data, this._remote);\r\n        \r\n    }\r\n\r\n    Start()\r\n    {\r\n        var syncResult = this._sync.Start();\r\n        return true;\r\n    }\r\n}"],"names":[],"mappings":";;;;;;;;;;;;;;;IAGe;QAGX,cAAY,IAAW,EAAE,MAAc;YACnC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;YAClB,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;SACzB;QAEK,oBAAK,GAAX;;gBACI,IAAI;oBACA,IAAI,MAAM,GAAW,IAAI,CAAC;oBAC1B,IAAM,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,aAAa,EAAE,CAAC;oBAC9C,IAAI,UAAU,IAAI,IAAI;wBAClB,MAAM,GAAG,UAAU,CAAC,EAAE,CAAC;oBAC3B,IAAM,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;oBAC1D,OAAO,CAAC,CAAC;iBAEb;gBAAA,OAAO,EAAE,EAAE;oBACP,MAAM,EAAE,CAAC;iBACZ;aACJ;SAAA;QACL,WAAC;IAAD,CAAC,IAAA;;ICtBc;QAEX;YACI,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;SACnB;QAED,6BAAa,GAAb;YACI,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC;gBAAE,OAAO,IAAI,CAAC;YACzC,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;SACxB;QACD,sCAAsB,GAAtB;YACI,IAAM,UAAU,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC;YACxC,IAAI,UAAU,IAAI,IAAI;gBAClB,OAAO,CAAC,CAAC;YACb,OAAO,UAAU,CAAC,SAAS,CAAC;SAC/B;QACD,sBAAM,GAAN,UAAO,MAAe;YAClB,IAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;YACpC,IAAI,KAAK,EAAE;gBACP,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,MAAM,CAAC;aAC9B;iBACI;gBACD,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;aAC3B;SACJ;QACL,YAAC;IAAD,CAAC,IAAA;;ICzBe;QAAA;SAGf;QAAD,aAAC;IAAD,CAAC,IAAA;;ICHD;IAGe;QAIX,gBAAY,QAAgB;YACxB,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;SAC7B;QAED,kCAAiB,GAAjB,UAAkB,QAAgB;YAC9B,OAAO,KAAK,CAAC,KAAG,IAAI,CAAC,SAAW,CAAC;iBAC5B,IAAI,CAAC,UAAC,QAAQ;gBACX,IAAI,QAAQ,CAAC,EAAE;oBACX,OAAO,QAAQ,CAAC,IAAI,EAAE,CAAC;gBAC3B,OAAO,IAAI,CAAC;aACf,CAAC;iBACD,IAAI,CAAC,UAAA,KAAK,IAAE,OAAA,KAAK,CAAC,GAAG,CAAE,UAAC,CAAC,IAAI,OAAA,IAAI,MAAM,EAAE,GAAA,CAAE,GAAA,CAAC;iBAC5C,QAAQ,CAAC,UAAA,CAAC;aAEV,CAAC,CAAA;SACT;QAEK,qBAAI,GAAV,UAAW,MAAe;;gBACtB,OAAO,IAAI,OAAO,CAAU,UAAC,CAAC,IAAG,OAAA,CAAC,CAAC,MAAM,CAAC,GAAA,CAAC,CAAC;aAC/C;SAAA;QACL,aAAC;IAAD,CAAC,IAAA;;;QCpBG,kBAAY,QAAgB;YAExB,IAAI,CAAC,KAAK,GAAG,IAAI,KAAK,EAAE,CAAC;YACzB,IAAI,CAAC,OAAO,GAAG,IAAI,MAAM,CAAC,QAAQ,CAAC,CAAC;YACpC,IAAI,CAAC,KAAK,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;SAEnD;QAED,wBAAK,GAAL;YAEI,IAAI,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;YACpC,OAAO,IAAI,CAAC;SACf;QACL,eAAC;IAAD,CAAC;;;;;;;;"}