<input type="text" bind:value="newItemText" />
<button on:click=send()>
	Send
</button>
<button on:click=deleteAll()>
	Delete all
</button>
<h4>Total Items: {items.length}</h4>
<ul>
	{#each items as item}
	<li>
		{item.id} - {item.text} - { item.timestamp } - { item.deleted } - <button on:click=deleteItem(item) >Delete</button>
	</li>
	{/each}
</ul>

<script>
	import CherryDb, { MemoryStore } from 'cherrydb'
	const db = new CherryDb('http://localhost:8765', new MemoryStore());
	let store = db.getStore();
	const colors = ['red', 'blue', 'green', 'purple', 'yellow', 'pink']
	export default {
		data() {
			return {
				newItemText: '',
				items: []
			}
		},
		oncreate() {
			db.Start(() => this.updateUI());
		},
		methods: {
			insertItems(n) {
				for (let i = 0; i < n; i++) {
					const newItem = db.Upsert({
						text: `Item ${i}`,
						color: colors[parseInt(Math.random() * colors.length)]
					});
				}
			},
			updateUI() {
				console.log('le callback', store.GetAllRecords())
				store.GetAllRecords()
					.then((records) => {
						this.set({
							items: records
						})
						let { items } = this.get();
						console.log('newthingy', items)
					});
			},
			send() {
				const { newItemText } = this.get();
				if (newItemText.length === 0) return;
				const newItem = db.Upsert({
					text: newItemText
				});
				this.updateUI();
				this.set({ newItemText: '' })
			},
			deleteAll() {
				store.GetAllRecords()
					.then((records) => {
						db.Delete(x => records.findIndex(r => r.id === x.id) >= 0)
					})

			},
			deleteItem(item) {
				db.Delete(x => x.id === item.id);
			}
		}
	}
</script>