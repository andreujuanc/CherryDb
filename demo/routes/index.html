<svelte:head>
	<title>Sapper project template</title>
</svelte:head>

<h1>[Fruit]Db demo</h1>

<ul>
	{#each items as item}
	<li>
		{item.id} - {item.text}
	</li>
	{/each}
</ul>
<input type="text" bind:value="newItemText" />
<button on:click=send()>
	Send
</button>
<script>
	import CherryDb from '../../client/build/cherrydb'
	const db = new CherryDb('http://localhost:8765');
	let store = db.getStore();

	export default {
		data() {
			return {
				newItemText: '',
				items: []
			}
		},
		oncreate() {
			db.Start(()=>this.updateUI());

		},
		methods: {
			updateUI(){
				console.log('le callback', store.GetAllRecords())
				var records = store.GetAllRecords();
				this.set({
					items : records
				})
				let { items } = this.get();
				console.log('newthingy', items)
			},
			send() {
				const {newItemText} = this.get();
				if(newItemText.length === 0 )return;
				console.log('CountA', store.Count())
				const newItem = db.Upsert({
					text: newItemText
				});				
				console.log('CountB', store.Count())
				//this.addItem(newItem)
				this.updateUI();
				this.set({
					newItemText: ''
				})
			},

		}
	}
</script>